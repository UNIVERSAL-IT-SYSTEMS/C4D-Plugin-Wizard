<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>c4dplugwiz &mdash; CINEMA 4D Plugin Wizard 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CINEMA 4D Plugin Wizard 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">CINEMA 4D Plugin Wizard 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for c4dplugwiz</h1><div class="highlight"><pre>
<span class="c">#!/usr/local/bin/python</span>
<span class="c"># encoding: utf-8</span>
<span class="c"># pylint: disable-msg=W0603,W0212,W0702,W0703</span>
<span class="sd">ur&#39;&#39;&#39;\</span>
<span class="sd">c4dplugwiz is a command line tool and a template system </span>
<span class="sd">that helps with creating python plugins for CINEMA 4D. </span>
<span class="sd">It works by copying pre-existing folder structures from</span>
<span class="sd">a data repository to a destination specified by the user.</span>

<span class="sd">Definition</span>
<span class="sd">----------</span>

<span class="sd">A *wizard* or *assistant* is defined to be any process</span>
<span class="sd">that is helpful in some creational undertaking, providing</span>
<span class="sd">means to a customizable starting point and easing the user </span>
<span class="sd">into the steps towards some goal.</span>

<span class="sd">Here, the goal is the creation of Python plugins, and the </span>
<span class="sd">means are blueprint folder structures. The files of which, </span>
<span class="sd">embed within their contents special text that is utilized </span>
<span class="sd">from a magic token and rules based templating system. </span>

<span class="sd">A *blueprint folder structure* is defined to be a collection</span>
<span class="sd">of directories and files representing one type of plugin that</span>
<span class="sd">can be created, e.g. tag plugin, command plugin, etc...</span>
<span class="sd">While there usually is a predetermined layout of directories</span>
<span class="sd">and subdirectories for each plugin type (see Py4D docs), the </span>
<span class="sd">contents of any enclosed files can be determined by the user.</span>
<span class="sd"> </span>
<span class="sd">The *source repository* is defined to be the path to the parent</span>
<span class="sd">folder that contains all blueprint folder structures.</span>

<span class="sd">How It Works</span>
<span class="sd">------------</span>

<span class="sd">The user supplies the following data:</span>

<span class="sd">    * plugin ID</span>
<span class="sd">    * plugin name</span>
<span class="sd">    * destination path(s)</span>
<span class="sd">    * author name (optional - see CLI args)</span>
<span class="sd">    * org name (optional - see CLI args)</span>

<span class="sd">Processing is then divided into 3 main steps:</span>

<span class="sd">    1. Copy blueprint folder structure to destination</span>
<span class="sd">    2. Perform text replacements in file and directory names</span>
<span class="sd">    3. Perform text replacements in file contents</span>

<span class="sd">1) First, copy the blueprint folder structure corresponding to</span>
<span class="sd">the specified plugin type from the source repository to a destination </span>
<span class="sd">folder (there can be multiple destinations). </span>

<span class="sd">2) Then, loop through the directories and files of the copied</span>
<span class="sd">folder structure and perform text replacements of magic tokens</span>
<span class="sd">and search terms found within the file and directory names.</span>

<span class="sd">3) Finally, parse the contents of each file within the copied </span>
<span class="sd">folder structure and perform magic token and rule based text </span>
<span class="sd">replacements.</span>

<span class="sd">Text Replacements</span>
<span class="sd">-----------------</span>

<span class="sd">There are two systems for replacing text:</span>

<span class="sd">    1. magic tokens</span>
<span class="sd">    2. search/replace rules</span>

<span class="sd">Magic Tokens</span>
<span class="sd">~~~~~~~~~~~~</span>

<span class="sd">A magic token is denoted by the syntax ``%!Datum!%``, where</span>
<span class="sd">``Datum`` is a variable term referring to one piece of data,</span>
<span class="sd">called a datum point. Datum points are generally concerned with</span>
<span class="sd">project relevant metadata (who, what, when - plugin id/name, </span>
<span class="sd">author/org, date/time). </span>

<span class="sd">Magic tokens can also have alternate forms, which insert a variation</span>
<span class="sd">of the replacement text. The syntax for this is ``%!DatumAsForm!%``. </span>
<span class="sd">Note the adverb ``As`` (case sensitive!), which is used as a separator </span>
<span class="sd">between the datum point and its form.</span>

<span class="sd">For example, if the datum point ``%!PluginName!%`` is found it will</span>
<span class="sd">be replaced by the name of the plugin as supplied by the user.</span>
<span class="sd">If the alternate form ``%!PluginNameAsIdentifier!%`` is found, the</span>
<span class="sd">name of the plugin as entered by the user will be sanitized for</span>
<span class="sd">illegal characters and transformed to *CamelCase* format.</span>

<span class="sd">There are a fixed number of variations per datum point and to find </span>
<span class="sd">out about those, pass the ``-l/--list-tokens`` flag to the CLI.</span>
<span class="sd"> </span>
<span class="sd">Currently, the following datum points can be used:</span>
<span class="sd"> </span>
<span class="sd">    - ``ID``            *supplied by user with a CLI argument*</span>
<span class="sd">    - ``PluginName``    *supplied by user with a CLI argument*</span>
<span class="sd">    - ``AuthorName``    *supplied by user with a CLI option, or an environment variable*</span>
<span class="sd">    - ``OrgName``       *supplied by user with a CLI option, or an environment variable*</span>
<span class="sd">    - ``Date``          *constructed from ``time.strftime()*``</span>
<span class="sd">    - ``Time``          *constructed from ``time.strftime()*``</span>
<span class="sd">    - ``DateTime``      *constructed from ``time.strftime()*``</span>
<span class="sd">    </span>
<span class="sd">Note: datum point names are case sensitive!</span>

<span class="sd">If a datum point is used but the corresponding value can&#39;t </span>
<span class="sd">be retrieved, an exception is raised to avoid continuing </span>
<span class="sd">with false information. To ensure a value is found for author</span>
<span class="sd">and organization names, you can pass the relevant values per </span>
<span class="sd">the CLI or set the environment variables ``C4DPLUGWIZ_AUTHORNAME`` </span>
<span class="sd">and ``C4DPLUGWIZ_ORGNAME`` respectively.</span>


<span class="sd">Search/Replace Rules</span>
<span class="sd">--------------------</span>

<span class="sd">Search/replace rules are specified as ``key = value`` mappings in a </span>
<span class="sd">file called ``rules.py``. There can be multiple rules files at different</span>
<span class="sd">locations, but one location will take precendence over the others as </span>
<span class="sd">indicated in the following listing:</span>

<span class="sd">With decreasing precedence:</span>

<span class="sd">    1. arbitrary file path, passed with ``-r/--rules-file`` CLI argument</span>
<span class="sd">    2. at the root level of each blueprint folder structure (*type local*)</span>
<span class="sd">    3. at the root level of the source repository (*repository global*)</span>

<span class="sd">Keys as well as values must be valid Python statements and can therefore </span>
<span class="sd">include raw regex strings (e.g. ``r&#39;[a-z]&#39;``) and functions calls </span>
<span class="sd">(e.g. ``time.strftime(&#39;%Y&#39;)``). </span>

<span class="sd">If you need to import additional modules in order to use some </span>
<span class="sd">functionality for keys or values, a special line, called an import line, </span>
<span class="sd">in ``rules.py`` can be used to specify a comma separated list of </span>
<span class="sd">modules to import. Each of these lines must have the following </span>
<span class="sd">syntax: ``# import module1,module2,module3 ...`` and so on</span>
<span class="sd">(the ellipsis not being part of the syntax). </span>

<span class="sd">Lines in ``rules.py`` other than an import line starting with the hash </span>
<span class="sd">character are considered comments and ignored, as well as lines that do </span>
<span class="sd">not have a format of ``&lt;key&gt;\s*=\s*&lt;value&gt;`` where ``&lt;...&gt;`` stands </span>
<span class="sd">for a variable term and ``\s*`` stands for zero or more spaces. </span>

<span class="sd">If you need a value for a key to span multiple lines, assign the </span>
<span class="sd">value in *raw text* form, e.g. between single, double or tripple </span>
<span class="sd">quotes and with carriage returns, line feeds etc. escaped. </span>

<span class="sd">Also, if you expect to make full use of non-ASCII characters, such </span>
<span class="sd">as accented e&#39;s or umlauts, keep in mind that you must define them </span>
<span class="sd">in ``rules.py`` as unicode string (``u&#39;...&#39;``) and set an encoding</span>
<span class="sd">comment at the very beginning (e.g. ``# coding: utf-8``). The same </span>
<span class="sd">goes for the strings in the templated file where the unicode value</span>
<span class="sd">should be inserted: these must be unicode strings too and the file</span>
<span class="sd">also needs a coding comment at the top. </span>


<span class="sd">:author:     André Berg</span>
<span class="sd">             </span>
<span class="sd">:copyright:  2013 Sera Media VFX. All rights reserved.</span>
<span class="sd">             </span>
<span class="sd">:license:    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);\n</span>
<span class="sd">             you may not use this file except in compliance with the License.</span>
<span class="sd">             You may obtain a copy of the License at</span>
<span class="sd">             </span>
<span class="sd">             http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="sd">             </span>
<span class="sd">             Unless required by applicable law or agreed to in writing, software</span>
<span class="sd">             distributed under the License is distributed on an **&quot;AS IS&quot;** **BASIS**,</span>
<span class="sd">             **WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND**, either express or implied.</span>
<span class="sd">             See the License for the specific language governing permissions and</span>
<span class="sd">             limitations under the License.</span>

<span class="sd">:contact:    andre.bergmedia@googlemail.com</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">shutil</span> <span class="kn">as</span> <span class="nn">su</span>
<span class="kn">import</span> <span class="nn">unicodedata</span> <span class="kn">as</span> <span class="nn">ud</span>

<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">RawDescriptionHelpFormatter</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PluginWizard&#39;</span><span class="p">,</span> <span class="s">&#39;TextFX&#39;</span><span class="p">]</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">__versionstr__</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">__version__</span><span class="p">)</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s">&#39;2011-04-30&#39;</span>
<span class="n">__updated__</span> <span class="o">=</span> <span class="s">&#39;2013-08-20&#39;</span>


<span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="s">&#39;DebugLevel&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DebugLevel&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">TESTRUN</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="s">&#39;TestRunLevel&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;TestRunLevel&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">PROFILE</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="s">&#39;ProfileLevel&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;ProfileLevel&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>


<span class="c"># GLOBALS</span>

<span class="n">PLUGIN_TYPE_CMD</span> <span class="o">=</span> <span class="s">&#39;cmdplugin&#39;</span>
<span class="n">PLUGIN_TYPE_TAG</span> <span class="o">=</span> <span class="s">&#39;tagplugin&#39;</span>
<span class="n">PLUGIN_ID_TESTING</span> <span class="o">=</span> <span class="mi">1000001</span>


<span class="n">DEFAULT_ENV_AUTHOR</span> <span class="o">=</span> <span class="s">&#39;C4DPLUGWIZ_AUTHORNAME&#39;</span>
<span class="n">DEFAULT_ENV_ORG</span> <span class="o">=</span> <span class="s">&#39;C4DPLUGWIZ_ORGNAME&#39;</span>
<span class="n">DEFAULT_ENV_DATA</span> <span class="o">=</span> <span class="s">&#39;C4DPLUGWIZ_DATA&#39;</span>

<span class="n">DEFAULT_FILE_EXCLUDES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;.DS_Store&#39;</span><span class="p">,</span> 
    <span class="s">&#39;.hotfiles.btree&#39;</span><span class="p">,</span>
    <span class="s">&#39;Thumbs.db&#39;</span><span class="p">,</span>
    <span class="s">&#39;desktop.ini&#39;</span>
<span class="p">]</span>

<span class="n">DEFAULT_DIR_EXCLUDES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;.git&#39;</span><span class="p">,</span>
    <span class="s">&#39;.svn&#39;</span><span class="p">,</span>
    <span class="s">&#39;.hg&#39;</span><span class="p">,</span>
    <span class="s">&#39;CVS&#39;</span><span class="p">,</span>
    <span class="s">&#39;.Trash&#39;</span><span class="p">,</span> 
    <span class="s">&#39;.Trashes&#39;</span><span class="p">,</span> 
    <span class="s">&#39;.fseventsd&#39;</span><span class="p">,</span> 
    <span class="s">&#39;.Spotlight-V100&#39;</span>
<span class="p">]</span>

<span class="n">DEFAULT_EXCLUDES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_FILE_EXCLUDES</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_DIR_EXCLUDES</span><span class="p">)))</span>

<span class="n">DEFAULT_DATADIR</span> <span class="o">=</span> <span class="s">&#39;c4dplugwiz_data&#39;</span>
<span class="n">DEFAULT_RULES_FILENAME</span> <span class="o">=</span> <span class="s">&#39;rules.py&#39;</span>

<span class="n">g_verbose</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c"># Use this section to set different token chars per OS</span>
<span class="c"># Just beware of illegal characters for the file system</span>
<span class="c"># which are different on Windows and OS X.</span>
<span class="c">#</span>
<span class="c"># Windows can&#39;t have: \ / : * ? &quot; &lt; &gt; |</span>
<span class="c"># OS X: can&#39;t have : (colon) I believe</span>
<span class="c">#</span>
<span class="k">if</span> <span class="s">&#39;darwin&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">:</span>
    <span class="c"># OS X</span>
    <span class="n">g_mts</span> <span class="o">=</span> <span class="s">&#39;%!&#39;</span>    <span class="c"># g_magictoken_start</span>
    <span class="n">g_mte</span> <span class="o">=</span> <span class="s">&#39;!%&#39;</span>    <span class="c"># g_magictoken_end</span>
    <span class="n">g_osx</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">g_win</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">elif</span> <span class="s">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">:</span>
    <span class="c"># Windows</span>
    <span class="n">g_mts</span> <span class="o">=</span> <span class="s">&#39;%!&#39;</span>
    <span class="n">g_mte</span> <span class="o">=</span> <span class="s">&#39;!%&#39;</span>
    <span class="n">g_osx</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">g_win</span> <span class="o">=</span> <span class="bp">True</span>


<span class="k">class</span> <span class="nc">CLIError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Generic exception to raise and log fatal errors </span>
<span class="sd">        during command line interface execution.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CLIError</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">msg</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span>


<div class="viewcode-block" id="TextFX"><a class="viewcode-back" href="../api.html#c4dplugwiz.TextFX">[docs]</a><span class="k">class</span> <span class="nc">TextFX</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Methods for processing and transforming text.&#39;&#39;&#39;</span>
    <span class="n">greek_chars</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;alpha&#39;</span><span class="p">:</span><span class="s">&#39;a&#39;</span><span class="p">,</span>
        <span class="s">&#39;beta&#39;</span><span class="p">:</span><span class="s">&#39;b&#39;</span><span class="p">,</span>
        <span class="s">&#39;chi&#39;</span><span class="p">:</span><span class="s">&#39;c&#39;</span><span class="p">,</span>
        <span class="s">&#39;Delta&#39;</span><span class="p">:</span><span class="s">&#39;D&#39;</span><span class="p">,</span>
        <span class="s">&#39;delta&#39;</span><span class="p">:</span><span class="s">&#39;d&#39;</span><span class="p">,</span>
        <span class="s">&#39;epsiv&#39;</span><span class="p">:</span><span class="s">&#39;e&#39;</span><span class="p">,</span>
        <span class="s">&#39;eta&#39;</span><span class="p">:</span><span class="s">&#39;h&#39;</span><span class="p">,</span>
        <span class="s">&#39;Gamma&#39;</span><span class="p">:</span><span class="s">&#39;G&#39;</span><span class="p">,</span>
        <span class="s">&#39;gamma&#39;</span><span class="p">:</span><span class="s">&#39;g&#39;</span><span class="p">,</span>
        <span class="s">&#39;iota&#39;</span><span class="p">:</span><span class="s">&#39;i&#39;</span><span class="p">,</span>
        <span class="s">&#39;kappa&#39;</span><span class="p">:</span><span class="s">&#39;k&#39;</span><span class="p">,</span>
        <span class="s">&#39;Lambda&#39;</span><span class="p">:</span><span class="s">&#39;L&#39;</span><span class="p">,</span>
        <span class="s">&#39;lambda&#39;</span><span class="p">:</span><span class="s">&#39;l&#39;</span><span class="p">,</span>
        <span class="s">&#39;mu&#39;</span><span class="p">:</span><span class="s">&#39;m&#39;</span><span class="p">,</span>
        <span class="s">&#39;nu&#39;</span><span class="p">:</span><span class="s">&#39;n&#39;</span><span class="p">,</span>
        <span class="s">&#39;Omega&#39;</span><span class="p">:</span><span class="s">&#39;W&#39;</span><span class="p">,</span>
        <span class="s">&#39;omega&#39;</span><span class="p">:</span><span class="s">&#39;w&#39;</span><span class="p">,</span>
        <span class="s">&#39;omicron&#39;</span><span class="p">:</span><span class="s">&#39;x&#39;</span><span class="p">,</span>
        <span class="s">&#39;Omicron&#39;</span><span class="p">:</span><span class="s">&#39;X&#39;</span><span class="p">,</span>
        <span class="s">&#39;Phi&#39;</span><span class="p">:</span><span class="s">&#39;F&#39;</span><span class="p">,</span>
        <span class="s">&#39;phi&#39;</span><span class="p">:</span><span class="s">&#39;f&#39;</span><span class="p">,</span>
        <span class="s">&#39;phiv&#39;</span><span class="p">:</span><span class="s">&#39;j&#39;</span><span class="p">,</span>
        <span class="s">&#39;Pi&#39;</span><span class="p">:</span><span class="s">&#39;P&#39;</span><span class="p">,</span>
        <span class="s">&#39;pi&#39;</span><span class="p">:</span><span class="s">&#39;p&#39;</span><span class="p">,</span>
        <span class="s">&#39;piv&#39;</span><span class="p">:</span><span class="s">&#39;v&#39;</span><span class="p">,</span>
        <span class="s">&#39;Psi&#39;</span><span class="p">:</span><span class="s">&#39;Y&#39;</span><span class="p">,</span>
        <span class="s">&#39;psi&#39;</span><span class="p">:</span><span class="s">&#39;y&#39;</span><span class="p">,</span>
        <span class="s">&#39;rho&#39;</span><span class="p">:</span><span class="s">&#39;r&#39;</span><span class="p">,</span>
        <span class="s">&#39;Rho&#39;</span><span class="p">:</span><span class="s">&#39;R&#39;</span><span class="p">,</span>
        <span class="s">&#39;Sigma&#39;</span><span class="p">:</span><span class="s">&#39;S&#39;</span><span class="p">,</span>
        <span class="s">&#39;sigma&#39;</span><span class="p">:</span><span class="s">&#39;s&#39;</span><span class="p">,</span>
        <span class="s">&#39;sigmav&#39;</span><span class="p">:</span><span class="s">&#39;V&#39;</span><span class="p">,</span>
        <span class="s">&#39;tau&#39;</span><span class="p">:</span><span class="s">&#39;t&#39;</span><span class="p">,</span>
        <span class="s">&#39;Tau&#39;</span><span class="p">:</span><span class="s">&#39;T&#39;</span><span class="p">,</span>
        <span class="s">&#39;Theta&#39;</span><span class="p">:</span><span class="s">&#39;Q&#39;</span><span class="p">,</span>
        <span class="s">&#39;theta&#39;</span><span class="p">:</span><span class="s">&#39;q&#39;</span><span class="p">,</span>
        <span class="s">&#39;thetav&#39;</span><span class="p">:</span><span class="s">&#39;j&#39;</span><span class="p">,</span>
        <span class="s">&#39;Xi&#39;</span><span class="p">:</span><span class="s">&#39;X&#39;</span><span class="p">,</span>
        <span class="s">&#39;xi&#39;</span><span class="p">:</span><span class="s">&#39;x&#39;</span><span class="p">,</span>
        <span class="s">&#39;zeta&#39;</span><span class="p">:</span><span class="s">&#39;z&#39;</span><span class="p">,</span>
        <span class="s">&#39;Zeta&#39;</span><span class="p">:</span><span class="s">&#39;Z&#39;</span>
    <span class="p">}</span>
    <span class="n">greek_trans</span> <span class="o">=</span> <span class="p">{</span> <span class="c"># IGNORE:W0109</span>
        <span class="s">u&#39;α&#39;</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span>  <span class="s">u&#39;Α&#39;</span><span class="p">:</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;β&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span>  <span class="s">u&#39;Β&#39;</span><span class="p">:</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;γ&#39;</span><span class="p">:</span> <span class="s">&#39;g&#39;</span><span class="p">,</span>  <span class="s">u&#39;Γ&#39;</span><span class="p">:</span> <span class="s">&#39;G&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;δ&#39;</span><span class="p">:</span> <span class="s">&#39;d&#39;</span><span class="p">,</span>  <span class="s">u&#39;Δ&#39;</span><span class="p">:</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;ε&#39;</span><span class="p">:</span> <span class="s">&#39;e&#39;</span><span class="p">,</span>  <span class="s">u&#39;Ε&#39;</span><span class="p">:</span> <span class="s">&#39;E&#39;</span><span class="p">,</span>
        <span class="s">u&#39;ζ&#39;</span><span class="p">:</span> <span class="s">&#39;z&#39;</span><span class="p">,</span>  <span class="s">u&#39;Ζ&#39;</span><span class="p">:</span> <span class="s">&#39;Z&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;η&#39;</span><span class="p">:</span> <span class="s">&#39;e&#39;</span><span class="p">,</span>  <span class="s">u&#39;Η&#39;</span><span class="p">:</span> <span class="s">&#39;E&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;θ&#39;</span><span class="p">:</span> <span class="s">&#39;th&#39;</span><span class="p">,</span> <span class="s">u&#39;Θ&#39;</span><span class="p">:</span> <span class="s">&#39;Th&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;ι&#39;</span><span class="p">:</span> <span class="s">&#39;i&#39;</span><span class="p">,</span>  <span class="s">u&#39;Ι&#39;</span><span class="p">:</span> <span class="s">&#39;I&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;κ&#39;</span><span class="p">:</span> <span class="s">&#39;k&#39;</span><span class="p">,</span>  <span class="s">u&#39;Κ&#39;</span><span class="p">:</span> <span class="s">&#39;K&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;λ&#39;</span><span class="p">:</span> <span class="s">&#39;l&#39;</span><span class="p">,</span>  <span class="s">u&#39;Λ&#39;</span><span class="p">:</span> <span class="s">&#39;L&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;μ&#39;</span><span class="p">:</span> <span class="s">&#39;m&#39;</span><span class="p">,</span>  <span class="s">u&#39;Μ&#39;</span><span class="p">:</span> <span class="s">&#39;M&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;ν&#39;</span><span class="p">:</span> <span class="s">&#39;n&#39;</span><span class="p">,</span>  <span class="s">u&#39;Ν&#39;</span><span class="p">:</span> <span class="s">&#39;N&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;ξ&#39;</span><span class="p">:</span> <span class="s">&#39;ks&#39;</span><span class="p">,</span> <span class="s">u&#39;Ξ&#39;</span><span class="p">:</span> <span class="s">&#39;Ks&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;ο&#39;</span><span class="p">:</span> <span class="s">&#39;o&#39;</span><span class="p">,</span>  <span class="s">u&#39;Ο&#39;</span><span class="p">:</span> <span class="s">&#39;O&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;π&#39;</span><span class="p">:</span> <span class="s">&#39;p&#39;</span><span class="p">,</span>  <span class="s">u&#39;Π&#39;</span><span class="p">:</span> <span class="s">&#39;P&#39;</span><span class="p">,</span>
        <span class="s">u&#39;ρ&#39;</span><span class="p">:</span> <span class="s">&#39;r&#39;</span><span class="p">,</span>  <span class="s">u&#39;Ρ&#39;</span><span class="p">:</span> <span class="s">&#39;R&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;σ&#39;</span><span class="p">:</span> <span class="s">&#39;s&#39;</span><span class="p">,</span>  <span class="s">u&#39;Σ&#39;</span><span class="p">:</span> <span class="s">&#39;S&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;τ&#39;</span><span class="p">:</span> <span class="s">&#39;t&#39;</span><span class="p">,</span>  <span class="s">u&#39;Τ&#39;</span><span class="p">:</span> <span class="s">&#39;T&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;υ&#39;</span><span class="p">:</span> <span class="s">&#39;y&#39;</span><span class="p">,</span>  <span class="s">u&#39;Υ&#39;</span><span class="p">:</span> <span class="s">&#39;Y&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;φ&#39;</span><span class="p">:</span> <span class="s">&#39;ph&#39;</span><span class="p">,</span> <span class="s">u&#39;Φ&#39;</span><span class="p">:</span> <span class="s">&#39;Ph&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;χ&#39;</span><span class="p">:</span> <span class="s">&#39;ch&#39;</span><span class="p">,</span> <span class="s">u&#39;Χ&#39;</span><span class="p">:</span> <span class="s">&#39;Ch&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;Ψ&#39;</span><span class="p">:</span> <span class="s">&#39;ps&#39;</span><span class="p">,</span> <span class="s">u&#39;Ψ&#39;</span><span class="p">:</span> <span class="s">&#39;Ps&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;ω&#39;</span><span class="p">:</span> <span class="s">&#39;o&#39;</span><span class="p">,</span>  <span class="s">u&#39;Ω&#39;</span><span class="p">:</span> <span class="s">&#39;O&#39;</span>        
    <span class="p">}</span>
    <span class="n">greek_alphabet</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">u&#39;α&#39;</span><span class="p">:</span> <span class="s">&#39;alpha&#39;</span><span class="p">,</span> <span class="s">u&#39;β&#39;</span><span class="p">:</span> <span class="s">&#39;beta&#39;</span><span class="p">,</span> <span class="s">u&#39;γ&#39;</span><span class="p">:</span> <span class="s">&#39;gamma&#39;</span><span class="p">,</span> <span class="s">u&#39;δ&#39;</span><span class="p">:</span> <span class="s">&#39;delta&#39;</span><span class="p">,</span> <span class="s">u&#39;ε&#39;</span><span class="p">:</span> <span class="s">&#39;epsilon&#39;</span><span class="p">,</span>
        <span class="s">u&#39;ζ&#39;</span><span class="p">:</span> <span class="s">&#39;zeta&#39;</span><span class="p">,</span> <span class="s">u&#39;η&#39;</span><span class="p">:</span> <span class="s">&#39;eta&#39;</span><span class="p">,</span> <span class="s">u&#39;θ&#39;</span><span class="p">:</span> <span class="s">&#39;theta&#39;</span><span class="p">,</span> <span class="s">u&#39;ι&#39;</span><span class="p">:</span> <span class="s">&#39;iota&#39;</span><span class="p">,</span> <span class="s">u&#39;κ&#39;</span><span class="p">:</span> <span class="s">&#39;kappa&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;λ&#39;</span><span class="p">:</span> <span class="s">&#39;lambda&#39;</span><span class="p">,</span> <span class="s">u&#39;μ&#39;</span><span class="p">:</span> <span class="s">&#39;mu&#39;</span><span class="p">,</span> <span class="s">u&#39;ν&#39;</span><span class="p">:</span> <span class="s">&#39;nu&#39;</span><span class="p">,</span> <span class="s">u&#39;ξ&#39;</span><span class="p">:</span> <span class="s">&#39;xi&#39;</span><span class="p">,</span> <span class="s">u&#39;ο&#39;</span><span class="p">:</span> <span class="s">&#39;omicron&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;π&#39;</span><span class="p">:</span> <span class="s">&#39;pi&#39;</span><span class="p">,</span> <span class="s">u&#39;ρ&#39;</span><span class="p">:</span> <span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="s">u&#39;σ&#39;</span><span class="p">:</span> <span class="s">&#39;sigma&#39;</span><span class="p">,</span> <span class="s">u&#39;ς&#39;</span><span class="p">:</span> <span class="s">&#39;fsigma&#39;</span><span class="p">,</span> <span class="s">u&#39;τ&#39;</span><span class="p">:</span> <span class="s">&#39;tau&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;υ&#39;</span><span class="p">:</span> <span class="s">&#39;upsilon&#39;</span><span class="p">,</span> <span class="s">u&#39;φ&#39;</span><span class="p">:</span> <span class="s">&#39;phi&#39;</span><span class="p">,</span> <span class="s">u&#39;χ&#39;</span><span class="p">:</span> <span class="s">&#39;chi&#39;</span><span class="p">,</span> <span class="s">u&#39;ψ&#39;</span><span class="p">:</span> <span class="s">&#39;psi&#39;</span><span class="p">,</span> <span class="s">u&#39;ω&#39;</span><span class="p">:</span> <span class="s">&#39;omega&#39;</span><span class="p">,</span> 
        
        <span class="s">u&#39;Α&#39;</span><span class="p">:</span> <span class="s">&#39;Alpha&#39;</span><span class="p">,</span> <span class="s">u&#39;Β&#39;</span><span class="p">:</span> <span class="s">&#39;Beta&#39;</span><span class="p">,</span> <span class="s">u&#39;Γ&#39;</span><span class="p">:</span> <span class="s">&#39;Gamma&#39;</span><span class="p">,</span> <span class="s">u&#39;Δ&#39;</span><span class="p">:</span> <span class="s">&#39;Delta&#39;</span><span class="p">,</span> <span class="s">u&#39;Ε&#39;</span><span class="p">:</span> <span class="s">&#39;Epsilon&#39;</span><span class="p">,</span>
        <span class="s">u&#39;Ζ&#39;</span><span class="p">:</span> <span class="s">&#39;Zeta&#39;</span><span class="p">,</span> <span class="s">u&#39;Η&#39;</span><span class="p">:</span> <span class="s">&#39;Eta&#39;</span><span class="p">,</span> <span class="s">u&#39;Θ&#39;</span><span class="p">:</span> <span class="s">&#39;Theta&#39;</span><span class="p">,</span> <span class="s">u&#39;Ι&#39;</span><span class="p">:</span> <span class="s">&#39;Iota&#39;</span><span class="p">,</span> <span class="s">u&#39;Κ&#39;</span><span class="p">:</span> <span class="s">&#39;Kappa&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;Λ&#39;</span><span class="p">:</span> <span class="s">&#39;Lambda&#39;</span><span class="p">,</span> <span class="s">u&#39;Μ&#39;</span><span class="p">:</span> <span class="s">&#39;Mu&#39;</span><span class="p">,</span> <span class="s">u&#39;Ν&#39;</span><span class="p">:</span> <span class="s">&#39;Nu&#39;</span><span class="p">,</span> <span class="s">u&#39;Ξ&#39;</span><span class="p">:</span> <span class="s">&#39;Xi&#39;</span><span class="p">,</span> <span class="s">u&#39;Ο&#39;</span><span class="p">:</span> <span class="s">&#39;Omicron&#39;</span><span class="p">,</span> <span class="s">u&#39;Π&#39;</span><span class="p">:</span> <span class="s">&#39;Pi&#39;</span><span class="p">,</span>
        <span class="s">u&#39;Ρ&#39;</span><span class="p">:</span> <span class="s">&#39;Rho&#39;</span><span class="p">,</span> <span class="s">u&#39;Σ&#39;</span><span class="p">:</span> <span class="s">&#39;Sigma&#39;</span><span class="p">,</span> <span class="s">u&#39;Τ&#39;</span><span class="p">:</span> <span class="s">&#39;Tau&#39;</span><span class="p">,</span> <span class="s">u&#39;Υ&#39;</span><span class="p">:</span> <span class="s">&#39;Upsilon&#39;</span><span class="p">,</span> <span class="s">u&#39;Φ&#39;</span><span class="p">:</span> <span class="s">&#39;Phi&#39;</span><span class="p">,</span> 
        <span class="s">u&#39;Χ&#39;</span><span class="p">:</span> <span class="s">&#39;Chi&#39;</span><span class="p">,</span> <span class="s">u&#39;Ψ&#39;</span><span class="p">:</span> <span class="s">&#39;Psi&#39;</span><span class="p">,</span> <span class="s">u&#39;Ω&#39;</span><span class="p">:</span> <span class="s">&#39;Omega&#39;</span>
    <span class="p">}</span>
    <span class="n">phonetic_umlauts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">u&#39;</span><span class="se">\xe4</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;ae&#39;</span><span class="p">,</span>
        <span class="s">u&#39;</span><span class="se">\xe6</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;ae&#39;</span><span class="p">,</span>
        <span class="s">u&#39;</span><span class="se">\xfc</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;ue&#39;</span><span class="p">,</span>
        <span class="s">u&#39;</span><span class="se">\xf6</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;oe&#39;</span><span class="p">,</span>
        <span class="s">u&#39;</span><span class="se">\xdf</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;ss&#39;</span><span class="p">,</span>
        <span class="s">u&#39;</span><span class="se">\xc4</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;Ae&#39;</span><span class="p">,</span>
        <span class="s">u&#39;</span><span class="se">\xc6</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;Ae&#39;</span><span class="p">,</span>
        <span class="s">u&#39;</span><span class="se">\xdc</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;Ue&#39;</span><span class="p">,</span>
        <span class="s">u&#39;</span><span class="se">\xd6</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;Oe&#39;</span><span class="p">,</span>
        <span class="s">u&#39;</span><span class="se">\u0153</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;oe&#39;</span><span class="p">,</span>
        <span class="s">u&#39;</span><span class="se">\u0276</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">&#39;oe&#39;</span>
    <span class="p">}</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TextFX</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TextFX.precomp_unicode"><a class="viewcode-back" href="../api.html#c4dplugwiz.TextFX.precomp_unicode">[docs]</a>    <span class="k">def</span> <span class="nf">precomp_unicode</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">canonical</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Precompose Unicode character sequences, using either canonical </span>
<span class="sd">        or nominal mapping. </span>
<span class="sd">        E.g. ``LATIN SMALL LETTER E`` (``U+0065``) + ``COMBINING ACUTE ACCENT`` (``U+0301``) </span>
<span class="sd">        becomes ``LATIN SMALL LETTER E WITH ACUTE`` (``U+00E9``). </span>
<span class="sd">        </span>
<span class="sd">        :param unicode word: the unicode word to preccompose</span>
<span class="sd">        :param bool canonical: if ``True`` combining diacritical </span>
<span class="sd">            marks will be mapped to their non-combining forms when they </span>
<span class="sd">            cannot be combined with the letter preceeding the position.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;E: param &#39;word&#39;: expected unicode, got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">word</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">canonical</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">ud</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s">&#39;NFKC&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">ud</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s">&#39;NFC&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        
        <span class="k">return</span> <span class="n">result</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TextFX.decomp_unicode"><a class="viewcode-back" href="../api.html#c4dplugwiz.TextFX.decomp_unicode">[docs]</a>    <span class="k">def</span> <span class="nf">decomp_unicode</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">canonical</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Decompose Unicode character sequences using either canonical </span>
<span class="sd">        or nominal mapping. </span>
<span class="sd">        </span>
<span class="sd">        E.g. ``LATIN SMALL LETTER E WITH ACUTE`` (``U+00E9``) becomes </span>
<span class="sd">        ``LATIN SMALL LETTER E`` (``U+0065``) + ``COMBINING ACUTE ACCENT`` (``U+0301``). </span>
<span class="sd">        </span>
<span class="sd">        :param unicode word: the unicode word to decompose</span>
<span class="sd">        :param bool canonical: if ``True`` non-combining </span>
<span class="sd">            diacritical marks will be mapped to their combining </span>
<span class="sd">            forms and maybe combined with the letter preceeding </span>
<span class="sd">            the position.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;E: param &#39;word&#39;: expected unicode, got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">word</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">canonical</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">ud</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">ud</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s">&#39;NFD&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        
        <span class="k">return</span> <span class="n">result</span>
    </div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TextFX.to_camelcase"><a class="viewcode-back" href="../api.html#c4dplugwiz.TextFX.to_camelcase">[docs]</a>    <span class="k">def</span> <span class="nf">to_camelcase</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">capitalized</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">u&#39;&#39;&#39;</span>
<span class="sd">        Convert &#39;word&#39; to CamelCase.</span>
<span class="sd">        </span>
<span class="sd">        Examples: </span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; TextFX.to_camelcase(&#39;hot flaming cats&#39;)</span>
<span class="sd">        &#39;HotFlamingCats&#39;</span>
<span class="sd">        &gt;&gt;&gt; TextFX.to_camelcase(&#39;HotFlamingCats&#39;)</span>
<span class="sd">        &#39;HotFlamingCats&#39;</span>
<span class="sd">        &gt;&gt;&gt; TextFX.to_camelcase(&#39;hotFlamingCats&#39;)</span>
<span class="sd">        &#39;HotFlamingCats&#39;</span>
<span class="sd">        &gt;&gt;&gt; TextFX.to_camelcase(&#39;hot_flaming_cats&#39;)</span>
<span class="sd">        &#39;HotFlamingCats&#39;</span>
<span class="sd">        &gt;&gt;&gt; TextFX.to_camelcase(&#39;Hot Flaming _ Cats&#39;)</span>
<span class="sd">        &#39;HotFlamingCats&#39;</span>
<span class="sd">        &gt;&gt;&gt; print TextFX.to_camelcase(u&#39;höt_fläming_cäts&#39;, False)</span>
<span class="sd">        hötFlämingCäts</span>
<span class="sd">        </span>
<span class="sd">        :param unicode word: the string to convert</span>
<span class="sd">        :param bool capitalized: if ``True``, always capitalize </span>
<span class="sd">            the first character of the result.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">__capitalizematch</span><span class="p">(</span><span class="n">matchobj</span><span class="p">):</span>
            <span class="n">grp1</span> <span class="o">=</span> <span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">grp1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">grp1</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#39;&#39;</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">ur&#39;_+([^_]+)&#39;</span><span class="p">,</span> <span class="n">__capitalizematch</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">ur&#39; ([^ ]+)&#39;</span><span class="p">,</span> <span class="n">__capitalizematch</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">capitalized</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">word</span>
    </div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TextFX.split_camelcase"><a class="viewcode-back" href="../api.html#c4dplugwiz.TextFX.split_camelcase">[docs]</a>    <span class="k">def</span> <span class="nf">split_camelcase</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Split a CamelCaseString into ``[&#39;Camel&#39;, &#39;Case&#39;, &#39;String&#39;]``.</span>
<span class="sd">        </span>
<span class="sd">        :param string word: the string to split</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#39;&#39;</span>
        <span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;[A-Z]+[a-z]*&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TextFX.abbreviate"><a class="viewcode-back" href="../api.html#c4dplugwiz.TextFX.abbreviate">[docs]</a>    <span class="k">def</span> <span class="nf">abbreviate</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">maxchars</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reduce some string to an abbreviation of a given length.</span>
<span class="sd">        Example:</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; TextFX.abbreviate(&#39;AndisSSuper_PluginSTOP &#39;)</span>
<span class="sd">        &#39;ASPS&#39;</span>
<span class="sd">        </span>
<span class="sd">        :param string word: the string to abbreviate</span>
<span class="sd">        :param int maxchars: if &gt; 0, determines length </span>
<span class="sd">            of abbreviation, e.g. with a length of 3, &#39;ASPS&#39; </span>
<span class="sd">            above becomes &#39;ASP&#39;.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#39;&#39;</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c">#pat = re.compile(r&#39;\b(\w)&#39;, re.UNICODE)</span>
        <span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;([A-Z])[A-Z]*[a-z]*&quot;</span><span class="p">)</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maxchars</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">maxchars</span><span class="p">]</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    </div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TextFX.sanitize"><a class="viewcode-back" href="../api.html#c4dplugwiz.TextFX.sanitize">[docs]</a>    <span class="k">def</span> <span class="nf">sanitize</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">safechar</span><span class="o">=</span><span class="s">&#39;_&#39;</span><span class="p">,</span> 
                 <span class="n">replace_umlauts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">replace_diacritics</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
                 <span class="n">replace_greek</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">allowed_chars</span><span class="o">=</span><span class="s">r&#39;_\-()&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;replace&#39;</span><span class="p">,</span> 
                 <span class="n">encoding</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">getdefaultencoding</span><span class="p">()):</span>
        <span class="sd">u&#39;&#39;&#39;</span>
<span class="sd">        Sanitize word so that it might be used as a filename </span>
<span class="sd">        in an online transfer or in software that needs to </span>
<span class="sd">        work on a restricted set of names for files and other</span>
<span class="sd">        resource descriptors, e.g. only underscores are allowed, </span>
<span class="sd">        no accented characters, etc.</span>
<span class="sd">        </span>
<span class="sd">        Tries to deal gracefully with higher order characters, </span>
<span class="sd">        such as diacritics so that the original meaning of a </span>
<span class="sd">        word may be preserved better than, for example, just </span>
<span class="sd">        replacing higher order chars with a char deemed safe, </span>
<span class="sd">        like an underbar &#39;_&#39;, e.g. given &#39;Über&#39;, &#39;Ueber&#39; or</span>
<span class="sd">        &#39;Uber&#39; are generally favorable to &#39;_ber&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Examples:</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; TextFX.sanitize(u&#39;Äsbëst-Shop&#39;)</span>
<span class="sd">        u&#39;_sb_st-Shop&#39;</span>
<span class="sd">        &gt;&gt;&gt; TextFX.sanitize(u&#39;Äsbëst-Shop&#39;, safechar=&#39;&#39;)</span>
<span class="sd">        u&#39;sbst-Shop&#39;</span>
<span class="sd">        &gt;&gt;&gt; TextFX.sanitize(u&#39;Äsbëst-Shop&#39;, safechar=&#39;&#39;, replace_umlauts=True)</span>
<span class="sd">        u&#39;Aesbst-Shop&#39;</span>
<span class="sd">        &gt;&gt;&gt; TextFX.sanitize(u&#39;Äsbëst-Shop&#39;, safechar=&#39;&#39;, replace_umlauts=True, replace_diacritics=True)</span>
<span class="sd">        u&#39;Aesbest-Shop&#39;</span>
<span class="sd">        &gt;&gt;&gt; TextFX.sanitize(u&#39;Äsbëst-Shop&#39;, safechar=&#39;&#39;, replace_umlauts=True, replace_diacritics=True, allowed_chars=&#39;&#39;)</span>
<span class="sd">        u&#39;AesbestShop&#39;</span>
<span class="sd">                        </span>
<span class="sd">        :param string word: the word to sanitize</span>
<span class="sd">        :param string safechar: the char to use for replacing non-allowed chars</span>
<span class="sd">        :param bool replace_umlauts: if True, replace umlauts like &#39;ä&#39; with a </span>
<span class="sd">            phonetic equivalent like &#39;ae&#39;.</span>
<span class="sd">        :param bool replace_diacritics: if True, replace diacritics with a </span>
<span class="sd">            decomposed form where the mark is dropped (e.g. &#39;ç&#39; becomes &#39;c&#39;)</span>
<span class="sd">        :param bool replace_greek: if True, replace greek letters with their </span>
<span class="sd">            translitterated name, e.g. &#39;π&#39; becomes &#39;pi&#39;.</span>
<span class="sd">        :param string allowed_chars: string of chars to leave unchanged. </span>
<span class="sd">            Note that the string is used within a regex.</span>
<span class="sd">        :param string errors: if &#39;strict&#39; raise whatever exception occurred.</span>
<span class="sd">            If &#39;replace&#39;, replace each character that causes an error during</span>
<span class="sd">            processing with an underscore. Default is &#39;replace&#39;.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">safechar</span>
        <span class="n">allowed_chars</span> <span class="o">+=</span> <span class="n">safechar</span>
        <span class="k">if</span> <span class="s">&#39; &#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_chars</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">safechar</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="n">word</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">replace_umlauts</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="s">u&#39;&#39;</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">phonetic_umlauts</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">+=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">phonetic_umlauts</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">errors</span> <span class="o">==</span> <span class="s">&#39;strict&#39;</span><span class="p">:</span>
                        <span class="k">raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">+=</span> <span class="n">safechar</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="k">if</span> <span class="n">replace_diacritics</span><span class="p">:</span>
            <span class="c"># canonically decompose the search string so we can &quot;weed out&quot; the diacritical marks</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">ud</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
            <span class="c"># dynamically generate combining marks list</span>
            <span class="n">marks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">u03</span><span class="si">%x%x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="n">marks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;unicode_escape&#39;</span><span class="p">))</span>        
            <span class="c"># loop through filename and filter out the diacritical marks</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s">u&#39;&#39;</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">marks</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">res</span> <span class="o">+=</span> <span class="n">char</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">errors</span> <span class="o">==</span> <span class="s">&#39;strict&#39;</span><span class="p">:</span>
                        <span class="k">raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">res</span> <span class="o">+=</span> <span class="n">safechar</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">res</span>
        <span class="k">if</span> <span class="n">replace_greek</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">greek_alphabet</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">+=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">greek_alphabet</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">errors</span> <span class="o">==</span> <span class="s">&#39;strict&#39;</span><span class="p">:</span>
                        <span class="k">raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">+=</span> <span class="n">safechar</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">ur&#39;[^a-zA-Z0-9</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="n">allowed_chars</span><span class="p">,</span> <span class="n">safechar</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">word</span>

</div></div>
<div class="viewcode-block" id="PluginWizard"><a class="viewcode-back" href="../api.html#c4dplugwiz.PluginWizard">[docs]</a><span class="k">class</span> <span class="nc">PluginWizard</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    CINEMA 4D plugin template wizard.</span>
<span class="sd">    </span>
<span class="sd">    Main class which provides methods for replacements in </span>
<span class="sd">    the names and contents of files contained within a folder </span>
<span class="sd">    structure.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">tokenchar_start</span>   <span class="o">=</span> <span class="n">g_mts</span>
    <span class="n">tokenchar_end</span>     <span class="o">=</span> <span class="n">g_mte</span>
    <span class="n">token_regex</span>       <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;</span><span class="si">%s</span><span class="s">(?P&lt;token&gt;\w+?)</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tokenchar_start</span><span class="p">,</span> <span class="n">tokenchar_end</span><span class="p">))</span>
    <span class="n">token_xform_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;</span><span class="si">%s</span><span class="s">(?P&lt;token&gt;\w+?)As(?P&lt;form&gt;\w+?)</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tokenchar_start</span><span class="p">,</span> <span class="n">tokenchar_end</span><span class="p">))</span>
    <span class="c">#import_regex      = re.compile(r&#39;#\s*import (?P&lt;modules&gt;[\w, ]+)&#39;)</span>
    <span class="c">#kvsplit_regex     = re.compile(r&#39;\s*=\s*&#39;)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">plugin_type</span><span class="o">=</span><span class="n">PLUGIN_TYPE_CMD</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PluginWizard</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_type</span> <span class="o">=</span> <span class="n">plugin_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;excludedFiles&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s">&#39;excludedFiles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_EXCLUDES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destdir</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;srcdataPath&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filename</span> <span class="o">=</span> <span class="n">DEFAULT_RULES_FILENAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filepath</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_tokentable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_ruleslist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_check_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;pluginId&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;E: plugin id not present in config object.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;srcdataPath&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;E: source data path not present in config object.&quot;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_check_destdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">somedir</span><span class="p">):</span>
        <span class="n">real_destdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">somedir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">real_destdir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destdir</span> <span class="o">=</span> <span class="n">real_destdir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;Invalid path for destination dir: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">real_destdir</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_find_rules_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Find the rules file to use. </span>
<span class="sd">        </span>
<span class="sd">        Set ``self._rules_filepath`` to absolute path if found.        </span>
<span class="sd">        Only accepts files with name equal to ``self._rules_filename``.</span>
<span class="sd">                </span>
<span class="sd">        Searches multiple locations with the following precedence:</span>
<span class="sd">        </span>
<span class="sd">            1. path supplied by CLI arg</span>
<span class="sd">            2. per plugin type (local)</span>
<span class="sd">            3. per sourcedata rootdir (global)</span>
<span class="sd">            </span>
<span class="sd">        :raise: CLIError if a rules file couldn&#39;t be found.</span>
<span class="sd">        :return: path to the rules file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s">&#39;rulesFile&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="n">rules_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;rulesFile&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rules_file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">rules_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">rules_file</span><span class="p">):</span>
            <span class="n">rules_filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;rulesFile&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>   
            <span class="n">rules_filepath</span> <span class="o">=</span> <span class="bp">None</span>     
            <span class="n">rules_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filename</span>
            <span class="n">candidate_paths</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;srcdataPath&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_type</span><span class="p">,</span> <span class="n">rules_filename</span><span class="p">)),</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;srcdataPath&#39;</span><span class="p">],</span> <span class="n">rules_filename</span><span class="p">))</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">cpath</span> <span class="ow">in</span> <span class="n">candidate_paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cpath</span><span class="p">):</span>
                    <span class="n">rules_filepath</span> <span class="o">=</span> <span class="n">cpath</span>
        <span class="k">if</span> <span class="n">rules_filepath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#if DEBUG: </span>
            <span class="c">#    print(&quot;rules file not found. Paths searched: %s%s&quot; % (os.linesep, os.linesep.join(candidate_paths)))</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">rules_filepath_dir</span><span class="p">,</span> <span class="n">rules_filepath_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rules_filepath</span><span class="p">)</span>  <span class="c"># IGNORE:W0612 @UnusedVariable</span>
            <span class="k">if</span> <span class="n">rules_filepath_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filename</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;rules file name doesn&#39;t match name specified for rules files. &quot;</span> <span class="o">+</span> 
                               <span class="s">&quot;Expected </span><span class="si">%r</span><span class="s">, got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_filename</span><span class="p">,</span> <span class="n">rules_filepath_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">rules_filepath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rules_filepath</span>
                     
    <span class="k">def</span> <span class="nf">_fill_tokentable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create and fill table of ``%!...!%`` magic tokens.</span>
<span class="sd">        </span>
<span class="sd">        Angle bracket based tokens are tokens where the value</span>
<span class="sd">        can be deferred automatically (to a degree), with as little </span>
<span class="sd">        user intervention as possible.</span>
<span class="sd">        </span>
<span class="sd">        Examples are date, time and author name determined</span>
<span class="sd">        from the logon environment.</span>
<span class="sd">        </span>
<span class="sd">        The table consists of a dict of metadata dicts, </span>
<span class="sd">        the latter of which can have multiple entries,</span>
<span class="sd">        one for each form the datum can be in. </span>
<span class="sd">        </span>
<span class="sd">        E.g. if the datum is ``AuthorName``, it can have a form as</span>
<span class="sd">        identifier, as abbreviation, etc.</span>
<span class="sd">        </span>
<span class="sd">        :param string plugin_id: unique ID for the plugin</span>
<span class="sd">        :param string plugin_name: name of the plugin as </span>
<span class="sd">            entered by the user</span>
<span class="sd">        :param string author_name: name of the author as </span>
<span class="sd">            entered by the user</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
        
        <span class="c"># Plugin ID</span>
        <span class="n">plugin_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;pluginId&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plugin_id</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plugin_id</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plugin_id</span> <span class="o">=</span> <span class="n">PLUGIN_ID_TESTING</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plugin_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plugin_id</span><span class="p">)</span>
        <span class="n">pluginid_tokens</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pluginid_tokens</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugin_id</span>
        <span class="n">pluginid_tokens</span><span class="p">[</span><span class="s">&#39;Entered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pluginid_tokens</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span><span class="p">[</span><span class="s">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pluginid_tokens</span>
        
        <span class="c"># Plugin Name</span>
        <span class="n">plugin_name</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;pluginName&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plugin_name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plugin_name</span> <span class="o">=</span> <span class="s">&#39;Unnamed Plugin&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plugin_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">)</span>
        <span class="n">pluginname_tokens</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pluginname_tokens</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugin_name</span>
        <span class="n">pluginname_tokens</span><span class="p">[</span><span class="s">&#39;Entered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugin_name</span>
        <span class="n">pluginname_tokens</span><span class="p">[</span><span class="s">&#39;Cleaned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">sanitize</span><span class="p">(</span>
            <span class="n">plugin_name</span><span class="p">,</span> <span class="n">safechar</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> 
            <span class="n">replace_umlauts</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
            <span class="n">replace_diacritics</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
            <span class="n">replace_greek</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
            <span class="n">allowed_chars</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">pluginname_tokens</span><span class="p">[</span><span class="s">&#39;Identifier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">to_camelcase</span><span class="p">(</span><span class="n">pluginname_tokens</span><span class="p">[</span><span class="s">&#39;Cleaned&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">pluginname_tokens</span><span class="p">[</span><span class="s">&#39;UppercaseIdentifier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">to_camelcase</span><span class="p">(</span><span class="n">pluginname_tokens</span><span class="p">[</span><span class="s">&#39;Cleaned&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">pluginname_tokens</span><span class="p">[</span><span class="s">&#39;Abbreviation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">abbreviate</span><span class="p">(</span><span class="n">pluginname_tokens</span><span class="p">[</span><span class="s">&#39;Cleaned&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span><span class="p">[</span><span class="s">&#39;PluginName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pluginname_tokens</span>
        
        <span class="c"># Author Name</span>
        <span class="n">author_name</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;author&#39;</span><span class="p">]</span>
        <span class="n">authorname_tokens</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">author_name</span><span class="p">:</span>
            <span class="n">authorname_tokens</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">author_name</span>
            <span class="n">authorname_tokens</span><span class="p">[</span><span class="s">&#39;Entered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">author_name</span>
            <span class="n">authorname_tokens</span><span class="p">[</span><span class="s">&#39;Cleaned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">sanitize</span><span class="p">(</span>
                <span class="n">author_name</span><span class="p">,</span> 
                <span class="n">replace_umlauts</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                <span class="n">replace_diacritics</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                <span class="n">replace_greek</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                <span class="n">allowed_chars</span><span class="o">=</span><span class="s">r&#39;_\-() &#39;</span><span class="p">)</span>
            <span class="n">authorname_tokens</span><span class="p">[</span><span class="s">&#39;Identifier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">to_camelcase</span><span class="p">(</span><span class="n">author_name</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="n">authorname_tokens</span><span class="p">[</span><span class="s">&#39;Abbreviation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">abbreviate</span><span class="p">(</span><span class="n">author_name</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span><span class="p">[</span><span class="s">&#39;AuthorName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">authorname_tokens</span>
            
        <span class="c"># Organization Name</span>
        <span class="n">org_name</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;org&#39;</span><span class="p">]</span>
        <span class="n">orgname_tokens</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">org_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">orgname_tokens</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">org_name</span>
            <span class="n">orgname_tokens</span><span class="p">[</span><span class="s">&#39;Entered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">org_name</span>
            <span class="n">orgname_tokens</span><span class="p">[</span><span class="s">&#39;Cleaned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">sanitize</span><span class="p">(</span>
                <span class="n">org_name</span><span class="p">,</span> <span class="n">safechar</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> 
                <span class="n">replace_umlauts</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                <span class="n">replace_diacritics</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                <span class="n">replace_greek</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                <span class="n">allowed_chars</span><span class="o">=</span><span class="s">r&#39;_\-()&#39;</span><span class="p">)</span>
            <span class="n">orgname_tokens</span><span class="p">[</span><span class="s">&#39;Identifier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">to_camelcase</span><span class="p">(</span><span class="n">org_name</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="n">orgname_tokens</span><span class="p">[</span><span class="s">&#39;Abbreviation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">abbreviate</span><span class="p">(</span><span class="n">org_name</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span><span class="p">[</span><span class="s">&#39;OrgName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orgname_tokens</span>
            
        <span class="c"># Date+Time</span>
        <span class="n">datetime_tokens</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">datetime_tokens</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%S&#39;</span><span class="p">)</span>
        <span class="n">datetime_tokens</span><span class="p">[</span><span class="s">&#39;Iso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime_tokens</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
        <span class="n">datetime_tokens</span><span class="p">[</span><span class="s">&#39;Locale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%x</span><span class="s"> </span><span class="si">%X</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span><span class="p">[</span><span class="s">&#39;DateTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime_tokens</span>
        
        <span class="c"># Date</span>
        <span class="n">date_tokens</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;IsoSeparated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;Iso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y%m</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;EnglishDashSeparated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%m-</span><span class="si">%d</span><span class="s">-%y&#39;</span><span class="p">)</span>
        <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;EnglishSeparated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%m/</span><span class="si">%d</span><span class="s">/%y&#39;</span><span class="p">)</span>
        <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;English&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%m</span><span class="si">%d</span><span class="s">%y&#39;</span><span class="p">)</span>
        <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;LocaleSeparated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%x</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;Locale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">sanitize</span><span class="p">(</span><span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;LocaleSeparated&#39;</span><span class="p">],</span> <span class="n">safechar</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">allowed_chars</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;NameOfDay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%A&#39;</span><span class="p">)</span>
        <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;ShortNameOfDay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%a&#39;</span><span class="p">)</span>
        <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_tokens</span><span class="p">[</span><span class="s">&#39;IsoSeparated&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span><span class="p">[</span><span class="s">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_tokens</span>
        
        <span class="c"># Time</span>
        <span class="n">time_tokens</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">time_tokens</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">sanitize</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%X</span><span class="s">&#39;</span><span class="p">),</span> <span class="n">safechar</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">allowed_chars</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">time_tokens</span><span class="p">[</span><span class="s">&#39;LocaleSeparated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%X</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">time_tokens</span><span class="p">[</span><span class="s">&#39;Locale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">sanitize</span><span class="p">(</span><span class="n">time_tokens</span><span class="p">[</span><span class="s">&#39;LocaleSeparated&#39;</span><span class="p">],</span> <span class="n">safechar</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">allowed_chars</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">time_tokens</span><span class="p">[</span><span class="s">&#39;EnglishSeparated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%H:%M:%S %p&#39;</span><span class="p">)</span>
        <span class="n">time_tokens</span><span class="p">[</span><span class="s">&#39;English&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextFX</span><span class="o">.</span><span class="n">sanitize</span><span class="p">(</span><span class="n">time_tokens</span><span class="p">[</span><span class="s">&#39;EnglishSeparated&#39;</span><span class="p">],</span> <span class="n">safechar</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">allowed_chars</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">time_tokens</span><span class="p">[</span><span class="s">&#39;SecondsSinceEpoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span><span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_tokens</span>
    
    <span class="k">def</span> <span class="nf">_fill_ruleslist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">        Parse the rules file and build the rules list. If there is not rules files,</span>
<span class="sd">        an empty list is returned.</span>
<span class="sd">        </span>
<span class="sd">        A rules file (usually called ``rules.py`` but this can be changed internally)</span>
<span class="sd">        contains a mapping of search terms to replacement terms, on one line each and </span>
<span class="sd">        separated by the regex ``\s*=\s*``. The search term comes first and then the </span>
<span class="sd">        replacement term follows. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filepath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_rules_file</span><span class="p">()</span>
        <span class="n">RULES</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c"># needs to be uppercase so it is shadowed from exec below</span>
        <span class="n">ruleslist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">rules_filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filepath</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rules_filedir</span><span class="p">,</span> <span class="n">rules_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rules_filepath</span><span class="p">)</span>   <span class="c"># IGNORE:W0612 @UnusedVariable</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rules_filepath</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="c"># if the following succeeds RULES is aliased by the</span>
                <span class="c"># contents of RULES in rules file at self._rules_filepath </span>
                <span class="k">exec</span><span class="p">(</span><span class="nb">compile</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">rules_filename</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">))</span>  <span class="c"># IGNORE:W0122</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;E: while processing </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rules_filename</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">search</span><span class="p">,</span> <span class="n">replace</span> <span class="ow">in</span> <span class="n">RULES</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">search</span><span class="p">)</span>
                <span class="n">ruleslist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">search</span><span class="p">,</span> <span class="n">replace</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_list</span> <span class="o">=</span> <span class="n">ruleslist</span>
        <span class="k">return</span> <span class="n">ruleslist</span>
    
    <span class="k">def</span> <span class="nf">_process_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">fileordirname</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">fileordirname</span><span class="p">)</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">fileext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fileordirname</span><span class="p">)</span>
        <span class="n">newpath</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">newname</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="c"># process rules (if we have a rules file)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">replaced</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">search</span><span class="p">,</span> <span class="n">replace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">replace</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
                    <span class="n">replaced</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">replaced</span><span class="p">:</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="n">fileext</span>
                <span class="n">newpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
                <span class="n">replaced</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="c"># process tokens</span>
        
        <span class="n">matchedtokens</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">PluginWizard</span><span class="o">.</span><span class="n">token_regex</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matchedtokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newname</span> <span class="o">=</span> <span class="n">fileordirname</span>
            <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">matchedtokens</span><span class="p">:</span>
                <span class="n">fulltoken</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenchar_start</span> <span class="o">+</span> <span class="n">mat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenchar_end</span>
                <span class="k">if</span> <span class="s">&#39;As&#39;</span> <span class="ow">in</span> <span class="n">mat</span><span class="p">:</span>
                    <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;As&#39;</span><span class="p">)</span>
                    <span class="n">token</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">form</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">token</span> <span class="o">=</span> <span class="n">mat</span>
                    <span class="n">form</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">fulltoken</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span><span class="p">[</span><span class="n">token</span><span class="p">][</span><span class="n">form</span><span class="p">],</span> <span class="n">newname</span><span class="p">)</span>
                
            <span class="n">newpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
            
        <span class="c"># do the actual renaming (if needed)</span>
        <span class="k">if</span> <span class="n">newpath</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">newpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newpath</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">g_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&quot;E: File at &#39;</span><span class="si">%s</span><span class="s">&#39; exists. Skipping...</span><span class="se">\n</span><span class="s">Use -f/--force to overwrite.&quot;</span> <span class="o">%</span> <span class="n">newpath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">g_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;  Renaming &#39;</span><span class="si">%s</span><span class="s">&#39; to &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fileordirname</span><span class="p">,</span> <span class="n">newname</span><span class="p">))</span>
                
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">newpath</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Renaming &#39;</span><span class="si">%s</span><span class="s">&#39; to &#39;</span><span class="si">%s</span><span class="s">&#39; failed: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">newpath</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="bp">True</span>
        
    <span class="k">def</span> <span class="nf">_process_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;excludedFiles&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">g_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Processing &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>  <span class="p">(</span><span class="n">format_relpath</span><span class="p">(</span><span class="n">filepath</span><span class="p">)))</span>

            <span class="c"># Backup</span>
            
            <span class="c"># rename this file to filename.bak</span>
            <span class="n">backup_filename</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">extsep</span><span class="p">,</span> <span class="s">&quot;bak&quot;</span><span class="p">)</span>
            <span class="n">backup_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">backup_filename</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="c"># remove filename.bak from last run if it is present</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">backup_filepath</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span> 
                <span class="k">pass</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">backup_filepath</span><span class="p">)</span>
            
            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">processed_file</span><span class="p">:</span>
                <span class="c"># then open a new file with this file&#39;s old name (w/o &quot;.bak&quot;)</span>
                <span class="c"># where we can write the processed lines to</span>
                <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">backup_filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">curfile</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">curfile</span><span class="p">:</span>
                        <span class="n">replaceline</span> <span class="o">=</span> <span class="n">line</span>
                        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">PluginWizard</span><span class="o">.</span><span class="n">token_regex</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                                <span class="k">if</span> <span class="s">&#39;As&#39;</span> <span class="ow">in</span> <span class="n">mat</span><span class="p">:</span>
                                    <span class="n">_mat</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;As&#39;</span><span class="p">)</span>
                                    <span class="n">token</span> <span class="o">=</span> <span class="n">_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="n">form</span> <span class="o">=</span> <span class="n">_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">token</span> <span class="o">=</span> <span class="n">mat</span>
                                    <span class="n">form</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">replace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span><span class="p">[</span><span class="n">token</span><span class="p">][</span><span class="n">form</span><span class="p">]</span>
                                    <span class="n">search</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenchar_start</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenchar_end</span><span class="p">)</span>
                                    <span class="n">replaceline</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">replace</span><span class="p">,</span> <span class="n">replaceline</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
                                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                    <span class="c"># can&#39;t use &quot;print&quot; here, since it would end up in the written replaceline</span>
                                    <span class="k">pass</span>
                        <span class="k">if</span>  <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">search</span><span class="p">,</span> <span class="n">replace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_list</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                                    <span class="n">replaceline</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">replace</span><span class="p">,</span> <span class="n">replaceline</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
                        <span class="n">processed_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">replaceline</span><span class="p">)</span>
            <span class="c"># done with the backup file, remove it</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">backup_filepath</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="PluginWizard.process_names"><a class="viewcode-back" href="../api.html#c4dplugwiz.PluginWizard.process_names">[docs]</a>    <span class="k">def</span> <span class="nf">process_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Do magic token and rule based replacements in file and rootdir names.</span>
<span class="sd">        </span>
<span class="sd">        A magic token has the form ``%!Value!%`` or ``%!ValueAsForm!%`` where</span>
<span class="sd">        ``Value`` is the value of an entry in the token table and ``Form`` </span>
<span class="sd">        a conjugate of that value. </span>
<span class="sd">        </span>
<span class="sd">        E.g. ``Value`` might be ``PluginName`` which would result in the </span>
<span class="sd">        plugin&#39;s name as entered by the user. </span>
<span class="sd">        </span>
<span class="sd">        ``PluginNameAsIdentifier`` is ``PluginName`` taking the form of an </span>
<span class="sd">        ``Identifier``, meaning it has invalid characters replaced, </span>
<span class="sd">        spaces stripped and converted to *CamelCase* form. </span>
<span class="sd">        </span>
<span class="sd">        There are multiple such forms for each magic token. </span>
<span class="sd">        For an overview call :py:func:`print_tokentable`.</span>
<span class="sd">        </span>
<span class="sd">        :param bool overwrite: if True, rename a file or rootdir even </span>
<span class="sd">            if it would replace an already existing file or rootdir.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">destdir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;E: dest dir can&#39;t be None. Did you forget to call set_destdir()?&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filepath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_rules_file</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_filepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">rules_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_filepath</span><span class="p">)</span>
                <span class="n">dest_rules_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destdir</span><span class="p">,</span> <span class="n">rules_filename</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># remove copied rules file if there was one in the </span>
                <span class="c"># source data dir for our plugin type</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dest_rules_file</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destdir</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">somedir</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_name</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">somedir</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">somefile</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">somefile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;excludedFiles&#39;</span><span class="p">]:</span>
                    <span class="k">continue</span>                    
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_name</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">somefile</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
        </div>
<div class="viewcode-block" id="PluginWizard.process_contents"><a class="viewcode-back" href="../api.html#c4dplugwiz.PluginWizard.process_contents">[docs]</a>    <span class="k">def</span> <span class="nf">process_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Replace tokens in file contents based on rules.py</span>
<span class="sd">        </span>
<span class="sd">        :param string exclude: if filename (incl. ext) </span>
<span class="sd">            matches this regex, the file is excluded from </span>
<span class="sd">            being processed. Note that ``self.excluded_files``</span>
<span class="sd">            are being skipped by default.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">destdir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;E: dest dir can&#39;t be None. Did you forget to call set_destdir()?&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destdir</span><span class="p">):</span>  <span class="c"># IGNORE:W0612 #@UnusedVariable</span>
            <span class="k">for</span> <span class="n">somefile</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">exclude</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">exclude</span><span class="p">,</span> <span class="n">somefile</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_content</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">somefile</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="PluginWizard.get_tokentable_listing"><a class="viewcode-back" href="../api.html#c4dplugwiz.PluginWizard.get_tokentable_listing">[docs]</a>    <span class="k">def</span> <span class="nf">get_tokentable_listing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a string with all data entries of the token table, including forms.</span>
<span class="sd">        </span>
<span class="sd">        :param int indent: how many spaces for indentation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">spaces</span> <span class="o">=</span> <span class="s">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_table</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">:&quot;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span> <span class="c"># default form</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s%s</span><span class="s">As</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">spaces</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">entry</span><span class="p">))</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
    <span class="k">def</span> <span class="nf">set_destdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">somepath</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_destdir</span><span class="p">(</span><span class="n">somepath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destdir</span> <span class="o">=</span> <span class="n">somepath</span>
    
</div>
<span class="k">def</span> <span class="nf">format_relpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Make ``path`` into a relative path with ``start`` </span>
<span class="sd">    as base and canonicalize path separators in the </span>
<span class="sd">    process.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="s">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span>
    <span class="k">elif</span> <span class="s">r&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s">r&#39;</span><span class="se">\\</span><span class="s">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">start</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">canonicalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Canonicalize path separators. &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">g_win</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">g_osx</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>


<span class="k">def</span> <span class="nf">truncate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">ellipsis</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">):</span>
    <span class="n">elen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ellipsis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s">&quot;mid&quot;</span><span class="p">:</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">max_size</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">elen</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">max_size</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">[:</span><span class="n">p1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ellipsis</span> <span class="o">+</span> <span class="n">path</span><span class="p">[</span><span class="n">p2</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s">&quot;start&quot;</span> <span class="ow">or</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s">&quot;left&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ellipsis</span> <span class="o">+</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">max_size</span><span class="o">-</span><span class="n">elen</span><span class="p">):]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># alignment == &quot;end&quot; or aligment == &quot;right&quot;</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">[:(</span><span class="n">max_size</span><span class="o">-</span><span class="n">elen</span><span class="p">)]</span> <span class="o">+</span> <span class="n">ellipsis</span>


<span class="k">def</span> <span class="nf">is_valid_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_valid_plugin_id</span><span class="p">(</span><span class="n">someId</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Test if &#39;someId&#39; is a valid Plugin Cafe ID. &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">someId</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">someId</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">someId</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">someId</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">someId</span> <span class="o">&gt;</span> <span class="mi">1000000</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_author_name</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">DEFAULT_ENV_AUTHOR</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">DEFAULT_ENV_AUTHOR</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fulluser</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">g_osx</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;USER&#39;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span>
                    <span class="p">[</span><span class="s">&#39;/bin/sh -c &quot;osascript -e </span><span class="se">\&#39;</span><span class="s">long user name of (system info)</span><span class="se">\&#39;</span><span class="s">&quot;&#39;</span><span class="p">],</span>
                    <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span>
                <span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">err</span><span class="p">:</span> 
                    <span class="k">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fulluser</span> <span class="o">=</span> <span class="n">out</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">fulluser</span> <span class="o">=</span> <span class="n">user</span>
        <span class="k">elif</span> <span class="n">g_win</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;USERNAME&#39;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">win32api</span> <span class="c"># IGNORE:F0401 @UnresolvedImport</span>
                <span class="n">fulluser</span> <span class="o">=</span> <span class="n">win32api</span><span class="o">.</span><span class="n">GetUserName</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">fulluser</span> <span class="o">=</span> <span class="n">user</span>
        <span class="k">if</span> <span class="n">fulluser</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;Unknown Author&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fulluser</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c"># IGNORE:E1103</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">get_company_name</span><span class="p">():</span>
    <span class="n">default</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">DEFAULT_ENV_ORG</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">DEFAULT_ENV_ORG</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">default</span>

<span class="k">def</span> <span class="nf">get_data_path</span><span class="p">():</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">DEFAULT_DATADIR</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">DEFAULT_ENV_DATA</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">DEFAULT_ENV_DATA</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">canonicalize_path</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convenience function for firing off commands to </span>
<span class="sd">    the system console. Used instead of `subprocess.call`_</span>
<span class="sd">    so that shell variables will be expanded properly.</span>
<span class="sd">    </span>
<span class="sd">    Not the same as `os.system`_ as here it captures </span>
<span class="sd">    returns ``stdout`` and ``stderr`` in a tuple in</span>
<span class="sd">    Python 2.5 and lower or a ``namedtuple`` in 2.6</span>
<span class="sd">    and higher. So you can use ``result[0]`` in the</span>
<span class="sd">    first case and ``result.out`` in the second.</span>

<span class="sd">    :param string cmd: a console command line</span>
<span class="sd">    :param list args: list of arguments that </span>
<span class="sd">        will be expanded in cmd starting with </span>
<span class="sd">        ``$0``.</span>
<span class="sd">    :return: ``tuple`` or ``namedtuple``</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fullcmd</span> <span class="o">=</span> <span class="n">cmd</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">r&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">r&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span><span class="p">)</span>
                               <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s">r&quot;\&#39;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="n">fullcmd</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">fullcmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="n">system</span><span class="o">.</span><span class="n">out</span> <span class="o">=</span> <span class="n">out</span>
    <span class="n">system</span><span class="o">.</span><span class="n">err</span> <span class="o">=</span> <span class="n">err</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
        <span class="n">StdStreams</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;StdStreams&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="s">&#39;err&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">StdStreams</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="n">err</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">rmtree_onerror</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">):</span>  <span class="c"># IGNORE:W0613</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Error handler for ``shutil.rmtree``.</span>

<span class="sd">    If the error is due to an access error (read only file)</span>
<span class="sd">    it attempts to add write permission and then retries.</span>

<span class="sd">    If the error is for another reason it re-raises the error.</span>

<span class="sd">    Usage : ``shutil.rmtree(path, onerror=onerror)``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">stat</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">):</span>
        <span class="c"># Is the error an access error ?</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IWUSR</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">g_win</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;rmdir /S /Q </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">g_osx</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;rm -rf </span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">copytree_ignore</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>  <span class="c"># IGNORE:W0613</span>
    <span class="n">excludes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_DIR_EXCLUDES</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">g_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">excludes</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Excluding &#39;</span><span class="si">%s</span><span class="s">&#39;. reason: in dir exclude list.&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">excludes</span>
    

<span class="n">CONFIG_DEFAULT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;pluginId&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">PLUGIN_ID_TESTING</span><span class="p">),</span>    <span class="c"># required</span>
    <span class="s">&#39;pluginName&#39;</span><span class="p">:</span> <span class="s">&#39;Unnamed Plugin&#39;</span><span class="p">,</span>        <span class="c"># optional</span>
    <span class="s">&#39;author&#39;</span><span class="p">:</span> <span class="n">get_author_name</span><span class="p">(),</span>           <span class="c"># optional</span>
    <span class="s">&#39;org&#39;</span><span class="p">:</span> <span class="n">get_company_name</span><span class="p">(),</span>             <span class="c"># optional</span>
    <span class="s">&#39;rulesFile&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>                     <span class="c"># optional, will be set later by search in sourcedata_path</span>
    <span class="s">&#39;srcdataPath&#39;</span><span class="p">:</span> <span class="n">get_data_path</span><span class="p">(),</span>        <span class="c"># required</span>
    <span class="s">&#39;excludedFiles&#39;</span><span class="p">:</span> <span class="n">DEFAULT_EXCLUDES</span>      <span class="c"># optional</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>  <span class="c"># IGNORE:C0111</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    :param list argv: a list of arguments to use instead of ``sys.argv``.</span>
<span class="sd">    :param bool extend: set to False if the passed ``argv`` should replace </span>
<span class="sd">        ``sys.argv`` completely instead of extending it. The GUI script uses </span>
<span class="sd">        this so that ``argv[0]`` which is usually the path to the executing </span>
<span class="sd">        program doesn&#39;t end up standing in for one of the needed args such</span>
<span class="sd">        as plugin ID and plugin name.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">extend</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">argv</span>
    
    <span class="n">program_name</span> <span class="o">=</span> <span class="s">&quot;c4dplugwiz&quot;</span>  <span class="c"># IGNORE:W0612 @UnusedVariable</span>
    <span class="n">program_version</span> <span class="o">=</span> <span class="s">&quot;v</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">__versionstr__</span>
    <span class="n">program_build_date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">__updated__</span><span class="p">)</span>
    <span class="n">program_version_message</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%%</span><span class="s">(prog)s </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">program_version</span><span class="p">,</span> <span class="n">program_build_date</span><span class="p">)</span>
    <span class="n">program_shortdesc</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;c4dplugwiz -- CINEMA 4D plugin wizard&#39;&#39;&#39;</span>
    <span class="n">program_license</span> <span class="o">=</span> <span class="s">u&#39;&#39;&#39;</span><span class="si">%s</span><span class="s"></span>
<span class="s">    </span>
<span class="s">  Created by André Berg on </span><span class="si">%s</span><span class="s">.</span>
<span class="s">  Copyright 2013 Sera Media VFX. All rights reserved.</span>
<span class="s">  </span>
<span class="s">  Licensed under the Apache License 2.0</span>
<span class="s">  http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s">  </span>
<span class="s">  Distributed on an &quot;AS IS&quot; basis without warranties</span>
<span class="s">  or conditions of any kind, either express or implied.</span>

<span class="s">&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">program_shortdesc</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">__date__</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Setup argument parser</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">program_license</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">)</span>
        
        <span class="c"># flags (optional)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="s">&#39;--list-tokens&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;list_tokens&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;list available tokens plus forms and exit.&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;verbose&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;set verbosity level [default: </span><span class="si">%(default)s</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-V&#39;</span><span class="p">,</span> <span class="s">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">program_version_message</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;--force&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;overwrite&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;overwrite existing target folders [default: </span><span class="si">%(default)s</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="s">&#39;--create-rootdir&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;createdir&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;create destination path if it doesn&#39;t exist [default: </span><span class="si">%(default)s</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--type&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;plugin_type&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;type of plugin to create. Determines which subfolder is used from the sourcedata rootdir [default: </span><span class="si">%(default)s</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-s&#39;</span><span class="p">,</span> <span class="s">&#39;--source-data&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;path to rootdir with source folder structures. Must have one folder structure per plugin type. You can also set the environment variable &#39;&quot;</span> <span class="o">+</span> <span class="n">DEFAULT_ENV_DATA</span> <span class="o">+</span> <span class="s">&quot;&#39;. [default: </span><span class="si">%(default)s</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-r&#39;</span><span class="p">,</span> <span class="s">&#39;--rules-file-name&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;rules_file&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;str&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;rules file name. If None, looks for a file &#39;rules.py&#39; relative to the main data dir or relative to each plugin type&#39;s template folder structure. If this is None, falls back to looking in the sourcedata rootdir. [default: </span><span class="si">%(default)s</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-a&#39;</span><span class="p">,</span> <span class="s">&#39;--author&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;author&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;name of the plugin author to be used in file/rootdir name replacements. You can also set the environment variable &#39;&quot;</span> <span class="o">+</span> <span class="n">DEFAULT_ENV_AUTHOR</span> <span class="o">+</span> <span class="s">&quot;&#39;. [default: </span><span class="si">%(default)s</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="s">&#39;--org&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;org&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;name of the organization the author belongs to, used for file/rootdir name replacements. You can also set the environment variable &#39;&quot;</span> <span class="o">+</span> <span class="n">DEFAULT_ENV_ORG</span> <span class="o">+</span> <span class="s">&quot;&#39;. [default: </span><span class="si">%(default)s</span><span class="s">]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--destination&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;dest&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;name of the destination folder. [default: </span><span class="si">%(default)s</span><span class="s">]&quot;</span><span class="p">)</span>
        
        <span class="c"># positional arguments (required)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="s">&quot;plugin_id&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;unique ID of the plugin (obtained from www.PluginCafe.com)&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&quot;?&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="s">&quot;plugin_name&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;name of the plugin.&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&quot;?&quot;</span><span class="p">)</span>
        
        <span class="c"># Environment variable defaults</span>
        <span class="n">default_source</span> <span class="o">=</span> <span class="n">get_data_path</span><span class="p">()</span>
        <span class="n">default_author</span> <span class="o">=</span> <span class="n">get_author_name</span><span class="p">()</span>
        <span class="n">default_org</span> <span class="o">=</span> <span class="n">get_company_name</span><span class="p">()</span>

        <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">default_source</span><span class="p">,</span> <span class="n">plugin_type</span><span class="o">=</span><span class="n">PLUGIN_TYPE_CMD</span><span class="p">,</span> 
                            <span class="n">author</span><span class="o">=</span><span class="n">default_author</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="n">default_org</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                            <span class="n">dest</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="n">list_tokens</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c"># Process arguments</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
        
        <span class="k">global</span> <span class="n">g_verbose</span>  <span class="c"># IGNORE:W0601</span>
        
        <span class="n">g_verbose</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span>
        <span class="n">list_tokens</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">list_tokens</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">dest</span><span class="p">]</span>
        <span class="n">plugin_id</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">plugin_id</span>
        <span class="n">plugin_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">plugin_name</span>
        <span class="n">plugin_type</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">plugin_type</span>
        <span class="n">source_datapath</span> <span class="o">=</span> <span class="n">canonicalize_path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">src</span><span class="p">)</span>
        <span class="n">overwrite</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">overwrite</span>
        <span class="n">createdir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">createdir</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">author</span>
        <span class="n">org</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">org</span>
        <span class="n">rules_file</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">rules_file</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">CONFIG_DEFAULT</span>
        
        <span class="c"># required</span>
        <span class="n">config</span><span class="p">[</span><span class="s">&#39;pluginId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugin_id</span>
        <span class="n">config</span><span class="p">[</span><span class="s">&#39;pluginName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugin_name</span>
        <span class="n">config</span><span class="p">[</span><span class="s">&#39;srcdataPath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_datapath</span>
        
        <span class="c"># optional</span>
        <span class="k">if</span> <span class="n">author</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s">&#39;author&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">author</span>
        <span class="k">if</span> <span class="n">org</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s">&#39;org&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">org</span>
        <span class="k">if</span> <span class="n">rules_file</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s">&#39;rulesFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rules_file</span>
        
        <span class="c"># Steps</span>
        <span class="c"># 1. Create and setup wizard. </span>
        
        <span class="c"># This also creates and fills the token table</span>
        <span class="c"># as well as the rules list.</span>
        <span class="n">pw</span> <span class="o">=</span> <span class="n">PluginWizard</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">plugin_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">list_tokens</span><span class="p">:</span>
            <span class="c"># print token table to stdout and exit</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">spaces</span> <span class="o">=</span> <span class="s">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Listing token table...&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Format:&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">Datum&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">spaces</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">DatumAsForm1&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">spaces</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">DatumAsForm2&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">spaces</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">spaces</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">pw</span><span class="o">.</span><span class="n">get_tokentable_listing</span><span class="p">(</span><span class="n">indent</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plugin_id</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;E: missing plugin id.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plugin_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;E: missing plugin name.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">source_datapath</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_valid_path</span><span class="p">(</span><span class="n">source_datapath</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;E: source data path invalid.&quot;</span><span class="p">)</span>
                        
        <span class="k">if</span> <span class="n">g_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Verbose mode on&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Plugin ID </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">    name: &#39;</span><span class="si">%s</span><span class="s">&#39; </span><span class="si">%s</span><span class="s">    type: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> 
                  <span class="p">(</span><span class="n">plugin_id</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="n">plugin_type</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rules_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">pw</span><span class="o">.</span><span class="n">_rules_filepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;     Using rules file at &#39;</span><span class="si">%s</span><span class="s">&#39; with </span><span class="si">%d</span><span class="s"> rules and </span><span class="si">%d</span><span class="s"> tokens.&quot;</span> <span class="o">%</span> 
                      <span class="p">(</span><span class="n">format_relpath</span><span class="p">(</span><span class="n">pw</span><span class="o">.</span><span class="n">_rules_filepath</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pw</span><span class="o">.</span><span class="n">_rules_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pw</span><span class="o">.</span><span class="n">_token_table</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>

        <span class="n">source</span> <span class="o">=</span> <span class="n">canonicalize_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_datapath</span><span class="p">,</span> <span class="n">plugin_type</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">source_datapath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;source data doesn&#39;t exist at path: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">canonicalize_path</span><span class="p">(</span><span class="n">source_datapath</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;couldn&#39;t find template folder structure for plugin type &#39;</span><span class="si">%s</span><span class="s">&#39; at &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> 
                           <span class="p">(</span><span class="n">plugin_type</span><span class="p">,</span> <span class="n">source</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">g_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;    Using source data at &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">format_relpath</span><span class="p">(</span><span class="n">source_datapath</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Using template structure &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">format_relpath</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                        
        <span class="k">for</span> <span class="n">destpath</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">g_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Processing destination &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">destpath</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                
            <span class="n">real_destpath</span> <span class="o">=</span> <span class="n">canonicalize_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">destpath</span><span class="p">))</span>
            <span class="n">full_destpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">real_destpath</span><span class="p">,</span> <span class="n">plugin_type</span><span class="p">)</span>
            <span class="n">named_fulldestpath</span> <span class="o">=</span> <span class="n">canonicalize_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">real_destpath</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">))</span>
            <span class="n">dest_parentdir</span><span class="p">,</span> <span class="n">destdir</span> <span class="o">=</span> <span class="n">real_destpath</span><span class="p">,</span> <span class="n">plugin_type</span>  <span class="c"># IGNORE:W0612 #@UnusedVariable</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dest_parentdir</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">createdir</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dest_parentdir</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="n">o755</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dest_parentdir</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;creating parent dir for destination &#39;</span><span class="si">%s</span><span class="s">&#39;  failed. skipping...&quot;</span> <span class="o">%</span> <span class="n">destpath</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;destination &#39;</span><span class="si">%s</span><span class="s">&#39; doesn&#39;t exist. skipping...&quot;</span> <span class="o">%</span> <span class="n">destpath</span><span class="p">)</span>
                                    
            <span class="c"># 2. Copy folder structure(s)</span>
            <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">named_fulldestpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">g_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Overwriting destination dir at &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>  <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">named_fulldestpath</span><span class="p">,</span> 
                                                                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">))))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">su</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">named_fulldestpath</span><span class="p">,</span> <span class="n">onerror</span><span class="o">=</span><span class="n">rmtree_onerror</span><span class="p">)</span>
                    <span class="n">su</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">named_fulldestpath</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="n">copytree_ignore</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;E: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">g_verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Copying template folder structure to destination.&quot;</span><span class="p">)</span>
                    <span class="n">su</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">named_fulldestpath</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="n">copytree_ignore</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s">&#39;exists&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">CLIError</span><span class="p">(</span><span class="s">&quot;dir exists: &#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">Use -f/--force to overwrite&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">full_destpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">))</span>          

            <span class="n">pw</span><span class="o">.</span><span class="n">set_destdir</span><span class="p">(</span><span class="n">named_fulldestpath</span><span class="p">)</span>
            
            <span class="c"># 3. Do file name replacements</span>
            <span class="n">pw</span><span class="o">.</span><span class="n">process_names</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
            
            <span class="c"># 4. Do file content replacements</span>
            <span class="n">pw</span><span class="o">.</span><span class="n">process_contents</span><span class="p">()</span>
            
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
<span class="c">#     except Exception as e:</span>
<span class="c">#         if DEBUG or TESTRUN:</span>
<span class="c">#             raise(e)</span>
<span class="c">#         sys.stderr.write(&quot;%s%s&quot; % (str(e), os.linesep))</span>
<span class="c">#         sys.stderr.write(&quot;for help use --help&quot;)</span>
<span class="c">#         return 2</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">TESTRUN</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">doctest</span>
        <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s">&#39;testrun&#39;</span><span class="p">):</span>
            <span class="n">su</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;testrun&#39;</span><span class="p">,</span> <span class="n">onerror</span><span class="o">=</span><span class="n">rmtree_onerror</span><span class="p">)</span>
        <span class="c">#os.environ[DEFAULT_ENV_DATA] = &quot;../unittests/data&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">DEFAULT_ENV_AUTHOR</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Andre Berg&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">DEFAULT_ENV_ORG</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Sera Media VFX&quot;</span>
        <span class="n">plugintype</span> <span class="o">=</span> <span class="s">&quot;tagplugin&quot;</span>
        <span class="c">#main([&#39;-l&#39;])</span>
        <span class="c">#main([&#39;-h&#39;])</span>
        <span class="n">main</span><span class="p">([</span><span class="s">&#39;--verbose&#39;</span><span class="p">,</span> <span class="s">&#39;--create-rootdir&#39;</span><span class="p">,</span> <span class="s">&#39;--force&#39;</span><span class="p">,</span> <span class="s">u&#39;--destination=testrun&#39;</span><span class="p">,</span> 
              <span class="s">u&#39;--org=&#39;</span><span class="p">,</span> <span class="s">u&#39;--author=Andre Berg&#39;</span><span class="p">,</span> <span class="s">u&#39;--type=cmdplugin&#39;</span><span class="p">,</span> 
              <span class="s">u&#39;1000001&#39;</span><span class="p">,</span> <span class="s">u&quot;Unnamed Plugins&quot;</span><span class="p">])</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">PROFILE</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">cProfile</span>
        <span class="kn">import</span> <span class="nn">pstats</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s">&#39;testrun&#39;</span><span class="p">,</span> <span class="n">onerror</span><span class="o">=</span><span class="n">rmtree_onerror</span><span class="p">):</span>
            <span class="n">su</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;testrun&#39;</span><span class="p">)</span>
        <span class="c">#os.environ[DEFAULT_ENV_DATA] = &quot;../tests/data&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">DEFAULT_ENV_AUTHOR</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Andre Berg&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">DEFAULT_ENV_ORG</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Sera Media VFX&quot;</span>
        <span class="n">profile_filename</span> <span class="o">=</span> <span class="s">&#39;c4dplugwiz_profile.pstats&#39;</span>
        <span class="n">cProfile</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">&#39;main([&quot;-v&quot;, &quot;-c&quot;, &quot;--type=tagplugin&quot;, &quot;-f&quot;, &quot;-d=testrun&quot;, &quot;1000001&quot;, &quot;My Plugin&quot;])&#39;</span><span class="p">,</span> <span class="n">profile_filename</span><span class="p">)</span>
        <span class="n">statsfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;profile_stats.txt&quot;</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pstats</span><span class="o">.</span><span class="n">Stats</span><span class="p">(</span><span class="n">profile_filename</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">statsfile</span><span class="p">)</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">strip_dirs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="s">&#39;cumulative&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(),</span> <span class="nb">file</span><span class="o">=</span><span class="n">statsfile</span><span class="p">)</span>
        <span class="n">statsfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">CINEMA 4D Plugin Wizard 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, André Berg.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>